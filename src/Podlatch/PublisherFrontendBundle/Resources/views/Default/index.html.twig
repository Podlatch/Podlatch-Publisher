{% extends "::base.html.twig" %}

{% block meta %}
    <link type="application/rss+xml" rel="alternate" title="{{ podcast.getTitle() }}" href="{{ url('publisher_frontend_itunes_feed',{'podcastId': podcast.getId()})  }}"/>
{% endblock %}

{% block content %}

            <div class="hero bg-gray">
                <div class="hero-body">
                    <div class="content">
                        <div class="columns">
                            <div class="column col-lg-12 col-9">

                                <h1 class="title">
                                    {{ podcast.getTitle() }}
                                </h1>
                                <h2 class="subtitle">
                                    {{ podcast.getSubtitle() }}
                                </h2>
                            </div>
                            <div class="column col-lg-12 col-3">
                                <script class="podlove-subscribe-button" src="./subscribe-button/javascripts/app.js" data-language="de" {% if podcast.getImage() %} data-format="cover"  {% endif %} data-color="#5755d9" data-size="big" data-style="frameless" data-json-data="podcastData"></script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

    <div class="content mt-4">
        <div class="columns">
            <div class="column col-12">
                <div class="" id="podlatch-player"></div>
            </div>
        </div>


        {{ podcast.getDescription() |nl2br }}

                <h2 class="subtitle is-2 level-item">Episodes</h2>

        <div class="timeline">
            {% for podcastEpisode in podcast.getPublishedEpisodes() %}
            <div class="timeline-item mt-2" id="{{podcastEpisode.getId()}}">
                <div class="timeline-left">
                    <a class="timeline-icon icon-lg tooltip" href="#{{podcastEpisode.getId()}}" data-tooltip="Link">
                        <i class="icon icon-link"></i>
                    </a>
                    <a class="timeline-icon" href="#{{podcastEpisode.getId()}}"></a>
                </div>
                <div class="timeline-content">
                    <div class="tile">
                        <div class="tile-icon">
                            <div class="example-tile-icon">
                                <i class="icon icon-file centered"></i>
                            </div>
                        </div>
                        <div class="tile-content">
                            <p class="tile-title"><h3>{{ podcastEpisode.getTitle() }}</h3></p>
                            <small class="tile-subtitle text-gray">{{ podcastEpisode.getReleasedAt()|date('d.m.Y') }}</small>
                            <p class="tile-subtitle"> {{ podcastEpisode.getSummary() |nl2br }}</p>
                        </div>
                        <div class="tile-action">
                            {% set foo = vich_uploader_asset(podcastEpisode, 'imageFile') %}
                            {% if foo == '' %}
                                {% set foo = vich_uploader_asset(podcast, 'imageFile') %}
                            {% endif %}

                            <button class="btn btn-primary" onclick="$('#podlatch-player').html(''); podlovePlayer('#podlatch-player', {
                                    title: '{{ podcastEpisode.getTitle() }}',
                                    subtitle: '{{ podcastEpisode.getSubtitle() }}',
                                    summary: '{{ podcastEpisode.getSummary()|json_encode }}',
                                    publicationDate: '{{ podcastEpisode.getReleasedAt()|date('d-m-YTH:i:s')}}',
                                    poster: '{{ foo }}',
                                    duration: '{{ podcastEpisode.getDuration(audioBasePath) }}',
                                    audio: [{
                                    url: '{{ app.request.getUriForPath(vich_uploader_asset(podcastEpisode, 'audioFile'))}}',
                                    mimeType: 'audio/mp3',
                                    size: {{ podcastEpisode.getFileSize(audioBasePath) }},
                                    title: 'Audio MP3'
                                    }],
                                    theme: {
                                    main: '#00D7B5'
                                    }
                                    }).then(function (store) {
                                    store.dispatch({
                                    type: 'UI_PLAY',
                                    payload: {}
                                    })})
                                    ;">
                                Play

                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>



    <script type="text/javascript" src="{{ asset('/js/podlove-embed.js') }}"></script>
    {% set latestEpisode = podcast.getPublishedEpisodes()|first %}
    {% if latestEpisode %}

        {% set foo = vich_uploader_asset(latestEpisode, 'imageFile') %}
        {% if foo == '' %}
            {% set foo = vich_uploader_asset(podcast, 'imageFile') %}
        {% endif %}

    <script>
        podlovePlayer('#podlatch-player', {
            title: '{{ latestEpisode.getTitle() }}',
            subtitle: '{{ latestEpisode.getSubtitle() }}',
            summary: '{{ latestEpisode.getSummary()|json_encode }}',
            publicationDate: '{{ latestEpisode.getReleasedAt()|date('d-m-YTH:i:s')}}',
            poster: '{{ foo }}',
            duration: '{{ latestEpisode.getDuration(audioBasePath) }}',
            audio: [{
                url: '{{ app.request.getUriForPath(vich_uploader_asset(latestEpisode, 'audioFile'))}}',
                mimeType: 'audio/mp3',
                size: {{ latestEpisode.getFileSize(audioBasePath) }},
                title: 'Audio MP3'
            }],
            visibleComponents: [
                'tabFiles',
                'tabAudio',
                'showTitle',
                'episodeTitle',
                'subtitle',
                'progressbar',
                'controlSteppers',
            ],
            theme: {
                main: '#ffffff'
            }
        });
    </script>
{% endif %}
    <script>
        window.podcastData = {
            "title": "{{ podcast.getTitle() }}",
            "subtitle": "{{ podcast.getSubtitle() }}",
            "description": "{{ podcast.getDescription()|json_encode }}",
            "cover": "{{ app.request.getUriForPath(vich_uploader_asset(podcast, 'imageFile'))}}",
            "feeds": [
                {
                    "type": "audio",
                    "format": "mp3",
                    "url": "{{ url('publisher_frontend_itunes_feed',{'podcastId': podcast.getId()})  }}",
                    "variant": "high",
                    "directory-url-itunes": "{{podcast.getItunesUrl()}}"

                }
            ]
        }
    </script>


{% endblock content%}